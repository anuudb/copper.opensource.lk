



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Copper email solution documentation">
      
      
        <link rel="canonical" href="https://copper.opensource.lk/Installation-7/">
      
      
        <meta name="author" content="Lanka Software Foundation">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.2.0">
    
    
      
        <title>Installation version 7 - Copper mail</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.750b69bd.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.224b79ff.css">
      
      
        
        
        <meta name="theme-color" content="#ffa000">
      
    
    
      <script src="../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="amber" data-md-color-accent="amber">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#installation-process" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://copper.opensource.lk" title="Copper mail" class="md-header-nav__button md-logo">
          
            <img src="../images/copper_logo.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Copper mail
            </span>
            <span class="md-header-nav__topic">
              Installation version 7
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/LSFLK/Copper/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    LSFLK/Copper
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://copper.opensource.lk" title="Copper mail" class="md-nav__button md-logo">
      
        <img src="../images/copper_logo.svg" width="48" height="48">
      
    </a>
    Copper mail
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/LSFLK/Copper/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    LSFLK/Copper
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../Overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../userfeature/" title="Features" class="md-nav__link">
      Features
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Structure/" title="Technical Documentation" class="md-nav__link">
      Technical Documentation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Prerequisites/" title="Prerequisites" class="md-nav__link">
      Prerequisites
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Installation/" title="Installation version 6" class="md-nav__link">
      Installation version 6
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Installation version 7
      </label>
    
    <a href="./" title="Installation version 7" class="md-nav__link md-nav__link--active">
      Installation version 7
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installation" title="Installation" class="md-nav__link">
    Installation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clone-this-repository" title="Clone this Repository" class="md-nav__link">
    Clone this Repository
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-the-following-folder-in-your-server" title="create the following folder in your server" class="md-nav__link">
    create the following folder in your server
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generate-certificate-files" title="Generate certificate files." class="md-nav__link">
    Generate certificate files.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#host-name-change-for-local-installation" title="Host name change for local installation" class="md-nav__link">
    Host name change for local installation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#start-the-copper-server-deployment" title="Start the copper-server deployment" class="md-nav__link">
    Start the copper-server deployment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#you-may-have-to-provide-following-informaiton-while-the-installation-process-is-going-on" title="You may have to provide following informaiton while the installation process is going on." class="md-nav__link">
    You may have to provide following informaiton while the installation process is going on.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#check-kubernetes-pods" title="Check kubernetes pods." class="md-nav__link">
    Check kubernetes pods.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#check-kubernetes-secrets" title="Check kubernetes secrets" class="md-nav__link">
    Check kubernetes secrets
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#check-kubernetes-services" title="Check kubernetes services." class="md-nav__link">
    Check kubernetes services.
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Configuration/" title="Initial Configuration" class="md-nav__link">
      Initial Configuration
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Backups/" title="Backup & Restoration" class="md-nav__link">
      Backup & Restoration
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../troubleshoot/" title="Troubleshoot" class="md-nav__link">
      Troubleshoot
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../HubInstallation/" title="Copper Hub Installation" class="md-nav__link">
      Copper Hub Installation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../issues/" title="Email security" class="md-nav__link">
      Email security
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../lsf/" title="LSF" class="md-nav__link">
      LSF
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../F&Q/" title="FAQ" class="md-nav__link">
      FAQ
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../contactus/" title="Contact us" class="md-nav__link">
      Contact us
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installation" title="Installation" class="md-nav__link">
    Installation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clone-this-repository" title="Clone this Repository" class="md-nav__link">
    Clone this Repository
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-the-following-folder-in-your-server" title="create the following folder in your server" class="md-nav__link">
    create the following folder in your server
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generate-certificate-files" title="Generate certificate files." class="md-nav__link">
    Generate certificate files.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#host-name-change-for-local-installation" title="Host name change for local installation" class="md-nav__link">
    Host name change for local installation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#start-the-copper-server-deployment" title="Start the copper-server deployment" class="md-nav__link">
    Start the copper-server deployment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#you-may-have-to-provide-following-informaiton-while-the-installation-process-is-going-on" title="You may have to provide following informaiton while the installation process is going on." class="md-nav__link">
    You may have to provide following informaiton while the installation process is going on.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#check-kubernetes-pods" title="Check kubernetes pods." class="md-nav__link">
    Check kubernetes pods.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#check-kubernetes-secrets" title="Check kubernetes secrets" class="md-nav__link">
    Check kubernetes secrets
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#check-kubernetes-services" title="Check kubernetes services." class="md-nav__link">
    Check kubernetes services.
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/LSFLK/Copper/edit/master/docs/Installation-7.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="installation-process">Installation Process<a class="headerlink" href="#installation-process" title="Permanent link">&para;</a></h1>
<h2 id="installation">Installation<a class="headerlink" href="#installation" title="Permanent link">&para;</a></h2>
<p><p align="justify">
This file describe the installation process in detailed for email version 7 and higher. Basically this deployment architecture is consists with kubernetes container orchestration facilites as shown in bellow figure. It consists with some kubernetes services like
secrets, ingress and deployments and services etc. So all interfaces can be accessed through a loadbalancer which works as a reverse proxy and all interfaces are https enabled with ingress deployment.</p>
</p>

<p><img alt="Deployment" src="../images/configuration/deployment.png" /></p>
<h2 id="clone-this-repository">Clone this Repository<a class="headerlink" href="#clone-this-repository" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>$ git clone https://github.com/LSFLK/Copper.git
</pre></div>


<h2 id="create-the-following-folder-in-your-server">create the following folder in your server<a class="headerlink" href="#create-the-following-folder-in-your-server" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>/data/ldap/certs
</pre></div>


<h2 id="generate-certificate-files">Generate certificate files.<a class="headerlink" href="#generate-certificate-files" title="Permanent link">&para;</a></h2>
<p><p align="justify">
This shell file will create necessary self signed certifcate for the system and then those certificates are used to create kubernetes tls secrets. 
</p></p>
<div class="codehilite"><pre><span></span>$ sh certification.sh 
</pre></div>


<p><img alt="Check copper pods" src="../images/installation/certs.png" /></p>
<h2 id="host-name-change-for-local-installation">Host name change for local installation<a class="headerlink" href="#host-name-change-for-local-installation" title="Permanent link">&para;</a></h2>
<p><p align="justify">
In localhost deployment for testing perposes it is must to add line for localhost for testing perposes.</p>
</p>

<div class="codehilite"><pre><span></span>$ nano /etc/hosts

add following line

127.0.0.1   &lt;you domain name&gt;

Ex : 127.0.0.1  copper.opensource.lk
</pre></div>


<h2 id="start-the-copper-server-deployment">Start the copper-server deployment<a class="headerlink" href="#start-the-copper-server-deployment" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>$ cd Copper/copper-server/kubernetes/deployment/
$ sh deploy.sh
</pre></div>


<h2 id="you-may-have-to-provide-following-informaiton-while-the-installation-process-is-going-on">You may have to provide following informaiton while the installation process is going on.<a class="headerlink" href="#you-may-have-to-provide-following-informaiton-while-the-installation-process-is-going-on" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>Enter mysql database name:

Ex : copper

Enter mysql database password:

Ex : copper

Your domain must contain 3 parts. (Eg: part1.part2.part3)
Enter the first part of domain:

Ex : copper

Enter the second part of domain:

Ex : test

Enter the third part of domain:

Ex : lk

Enter LDAP admin password:

Ex : admin

Enter LDAP readonly user name:

Ex : raa

Enter LDAP readonly user password:

Ex : raa

Enter organization name

Ex : lsf

Enter password for spam filter (RspamD)

Ex : spam
</pre></div>


<p>Ex : Image of running deply.sh</p>
<p><img alt="Check copper pods" src="../images/installation/install.png" /></p>
<h2 id="check-kubernetes-pods">Check kubernetes pods.<a class="headerlink" href="#check-kubernetes-pods" title="Permanent link">&para;</a></h2>
<p align="justify">

Then system installation process will begin. It will not take much time to install the system. But it is must to check kubernetes pods whether to know system is installed successfully. All pods status must be "Running".
</p>

<div class="codehilite"><pre><span></span>$kubectl get pods -n copper
</pre></div>


<p><img alt="Check copper pods" src="../images/installation/pods2.png" /></p>
<h2 id="check-kubernetes-secrets">Check kubernetes secrets<a class="headerlink" href="#check-kubernetes-secrets" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>kubectl get secrets -n copper
</pre></div>


<p>Following sercrets should have been created.</p>
<p><img alt="Check copper secrets" src="../images/installation/secrets.png" /></p>
<div class="codehilite"><pre><span></span>email-secret          Opaque                                57     1h
tls-certificate       kubernetes.io/tls                     2      1h
tls-dhparam           Opaque                                1      1h
</pre></div>


<h2 id="check-kubernetes-services">Check kubernetes services.<a class="headerlink" href="#check-kubernetes-services" title="Permanent link">&para;</a></h2>
<p align="justify">

Further kubernetes services also should be checked. All LoadBalancers External IP should be "localhost" and all nodeport's External IP should be  "<none>". PORTs can be seen from bellow command and 
</p>

<div class="codehilite"><pre><span></span>$kubectl get services -n copper
</pre></div>


<p><img alt="Check copper services" src="../images/installation/services2.png" /></p>
<p>## Check kubernetes services.</p>
<p align="justify">
If services are ok, check using browser whether you can access these interfaces. "copper.opensource.lk" is the domain name you configured in the host file.
</p>

<p>Groupoffice</p>
<div class="codehilite"><pre><span></span>https://copper.opensource.lk/
</pre></div>


<p>phpldapadmin</p>
<div class="codehilite"><pre><span></span>https://copper.opensource.lk/phpldapadmin/
</pre></div>


<p>user password change</p>
<div class="codehilite"><pre><span></span>https://copper.opensource.lk/service/
</pre></div>


<p>If you find any issue accessing above urls then just try recreating ingress loadbalancer.</p>
<div class="codehilite"><pre><span></span># Delete existing ingress

kubectl delete service nginx-ingress -n copper

kubectl delete deployment nginx-ingress-controller -n copper

# Exicute following command from kubernetes folder to recreate ingress 

kubectl create -f Ingress/nginx-controller.yaml
</pre></div>


<p align="justify">
Some time it is required to uninstall the system. For that there is a shell script uninstall.sh 
</p>

<div class="codehilite"><pre><span></span>$ sh undeploy.sh
</pre></div>


<p>Ex : Image of running undeploy.sh</p>
<p><img alt="Uninstallation" src="../images/installation/uninstall.png" /></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../Installation/" title="Installation version 6" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Installation version 6
              </span>
            </div>
          </a>
        
        
          <a href="../Configuration/" title="Initial Configuration" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Initial Configuration
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2018 - 2019 Lanka Software Foundation
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.39abc4af.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>